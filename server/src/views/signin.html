<html>

<head>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;500;600;700&display=swap"
    rel="stylesheet" />

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" />

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous" />
  <link href="/static/styles/signin.css" rel="stylesheet" />
  <script src="/static/libs/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.5/dist/jquery.validate.js"></script>
  <script src="/static/libs/slick.min.js"></script>
</head>

<body>
  <section class="main-box">
    <div class="slider-cont">
      <div class="signup-slider">
        <div class="img-txt">
          <div class="img-layer"></div>
          <h1>Support for group chat.</h1>
          <img src="https://static.pexels.com/photos/33972/pexels-photo.jpg" />
        </div>
        <div class="img-txt">
          <div class="img-layer"></div>
          <h1>Support for pictures, video, and other multimedia</h1>
          <img src="https://static.pexels.com/photos/257897/pexels-photo-257897.jpeg" />
        </div>
        <div class="img-txt">
          <div class="img-layer"></div>
          <h1>No price tag</h1>
          <img src="https://static.pexels.com/photos/317383/pexels-photo-317383.jpeg" />
        </div>
      </div>
    </div>

    <div class="form-cont">
      <div class="top-buttons">
        <button class="to-signin top-active-button">Sign In</button>
        <button class="to-signup">Sign Up</button>
      </div>
      <h6 class="errors" id="errorMessage"></h6>
      <div class="form form-signup">
        <form action="#" id="signUpform">
          <div class="field">
            <lable>FULL NMAE</lable>
            <input type="text" placeholder="Your full name" name="fullName" />
          </div>
          <div class="field">
            <lable>E-MAIL</lable>
            <input type="email" placeholder="Your e-mail" name="email" />
          </div>
          <div class="field">
            <lable>PASSWORD</lable>
            <input type="password" placeholder="Your password" name="password" />
          </div>
          <p class="terms">
            <input type="checkbox" name="termsofservice" value="1" />
            I agree all statments in
            <a href="javascript:void(0)" class="lined-link">terms of service</a>
          </p>
          <input type="button" class="form-btn" value="Sign Up" id="signUp" />
          <br /><br />
          <a href="javascript:void(0)" class="lined-link to-signin-link">I'm already member</a>
        </form>
      </div>

      <div class="form form-signin">
        <form action="#" id="signinform">
          <div class="field">
            <lable>E-MAIL</lable>
            <input type="email" placeholder="Your e-mail" name="lemail" />
          </div>
          <div class="field">
            <lable>PASSWORD</lable>
            <input type="password" placeholder="Your password" name="lpassword" />
          </div>
          <div class="field">
            <input type="button" class="form-btn" value="Sign In" id="signIn" />
          </div>
          <a href="javascript:void(0)" class="lined-link to-signup-link">Create new account</a>
        </form>
      </div>
    </div>
    <div class="clear-fix"></div>
  </section>
  <script>
    $(document).ready(function () {
      $('#signUpform').validate({ // initialize the plugin
        rules: {
          email: {
            required: true,
            email: true
          },
          fullName: {
            required: true,
            minlength: 5
          },
          password: {
            required: true,
            minlength: 5
          },
          // termsofservice: {
          //   required: function (elem) {
          //     if ($("input[name=termsofservice]").val() == 1) {
          //       return true;
          //     }
          //     else {
          //       return false;
          //     }
          //   },
          // }
        },
        submitHandler: function (form) { // for demo
          alert('valid form submitted'); // for demo

          return false; // for demo
        }
      });
      $('#signinform').validate({ // initialize the plugin
        rules: {
          lemail: {
            required: true,
            email: true
          },
          lpassword: {
            required: true
          }
        },
        submitHandler: function (form) { // for demo
          alert('valid form submitted'); // for demo
          return false; // for demo
        }
      });
      $(".signup-slider").slick({
        dots: true,
        arrows: false,
        autoplay: true,
        autoplaySpeed: 2000,
      });

      $("img").height($(".main-box").height());

      $(".to-signin").on("click", function () {
        $(this)
          .addClass("top-active-button")
          .siblings()
          .removeClass("top-active-button");
        $(".form-signup").slideUp(500);
        $(".form-signin").slideDown(500);
      });

      $(".to-signup").on("click", function () {
        $(this)
          .addClass("top-active-button")
          .siblings()
          .removeClass("top-active-button");
        $(".form-signin").slideUp(500);
        $(".form-signup").slideDown(500);
      });

      $(".to-signin-link").on("click", function () {
        $(".to-signin")
          .addClass("top-active-button")
          .siblings()
          .removeClass("top-active-button");
        $(".form-signup").slideUp(200);
        $(".form-signin").slideDown(200);
      });

      $(".to-signup-link").on("click", function () {
        $(".to-signup")
          .addClass("top-active-button")
          .siblings()
          .removeClass("top-active-button");
        $(".form-signin").slideUp(200);
        $(".form-signup").slideDown(200);
      });
      $("#signUp").on("click", function () {
        const fullName = $("input[name='fullName']").val();
        const email = $("input[name='email']").val();
        const password = $("input[name='password']").val();
        const reqBody = { fullName, email, password };
        const isValid = $('#signUpform').valid();
        const isTermsofservice = $("input[name=termsofservice]").is(':checked');
        if (isValid) {
          if (!isTermsofservice) {
            alert("Please accept terms and conditions");
            return false;
          }
          $.ajax({
            type: "POST", //rest Type
            url: "/api/register",
            async: true,
            data: JSON.stringify(reqBody),
            contentType: "application/json; charset=utf-8",
            success: function (response) {
              const { status, msg, url } = response
              if (status == "OK") {
                alert("Thank you for filling out our sign up form. We are glad that you joined us. click on sign to login");
                window.location.href = "/";
              }
              else if (status === 'Fail' && msg == "That email is already taken, please try another.") {
                alert(msg + "or Please click on 'Sign In' to login");
              } else {
                console.log(response);
              }
            },
          });
        } else {
          alert("Please fill form data");
        }
      });
      $("#signIn").on("click", function () {
        const email = $("input[name='lemail']").val();
        const password = $("input[name='lpassword']").val();
        const isValid = $('#signinform').valid();
        if (isValid) {
          const reqBody = { email, password };
          $.ajax({
            type: "POST", //rest Type
            url: "/api/login",
            async: true,
            data: JSON.stringify(reqBody),
            contentType: "application/json; charset=utf-8",
            success: function (response) {
              const { msg, status, url } = response;
              if (status == "OK") {
                window.location.href = url;
              }
              else {
                showErrorMsg(msg)
                console.log(response);
              }
            }
          });
        } else {
          alert("Please fill form data");
        }
      });
    });
    function showErrorMsg(msg) {
      $("#errorMessage").show();
      $("#errorMessage").html(msg);
      setTimeout(function () {
        $("#errorMessage").slideUp(300).delay(8000).fadeOut(400);
      }, 10000);
    }
  </script>
</body>

</html>